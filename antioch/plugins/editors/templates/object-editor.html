{% extends 'client/trivial.html' %}
{% load widget_tweaks %}
{% load staticfiles %}
{% load bootstrap4 %}

{% block header %}
{# {% include 'client/autocomplete_light/static.html' %} #}
<link rel="stylesheet/less" type="text/css" href="{% static 'less/object-editor.less' %}" />
<script type="text/javascript">
$(document).ready(function(){
  less.sheets.push($('link[href="{% static 'less/object-editor.less' %}"]')[0]);
  less.refresh();
});
</script>
{% endblock %}

{% block content %}

<div class="container-fluid">
  <div class="object editor row">
    <div class="col-xs-12 col-md-6">
      <form id="object-form" method="POST" action="{{ request.path }}">
        {% csrf_token %}
        {{ form.errors }}
        <div class="form-group row">
          <div class="col-xs-8 col-md-8">
            {% bootstrap_field form.name %}
          </div>
          <div class="col">
            <label class="control-label" id="access-label" for="access-button">&nbsp;</label><br>
            <button type="button" class="btn block" id="access-button">access...</button>
          </div>
        </div>
        <div class="form-group">
          {% bootstrap_field form.parents %}
        </div>
        <div class="form-group">
          {% bootstrap_field form.location %}
        </div>
        <div class="form-group">
          {% bootstrap_field form.owner %}
        </div>
      </div>
      <div class="attributes col-xs-12 col-md-6">
        <div class="row">
          <div class="verbs col-sm">
            <label id="verbs-label" for="verbs-select">verbs:</label>
            <select id="verbs-select" size="2" class="form-control">
            {% for verb in form.instance.verbs.all %}
              <option value="{{ verb.id }}">{{ verb.annotated }}</option>
            {% endfor %}
            </select>
            <div class="btn-group">
              <button type="button" class="btn btn-default" id="add-verb"><span class="glyphicon glyphicon-plus"></span></button>
              <button type="button" class="btn btn-default" id="remove-verb"><span class="glyphicon glyphicon-minus"></span></button>
            </div>
          </div>
          <div class="properties col-sm">
            <label id="properties-label" for="properties-select">properties:</label>
            <select id="properties-select" size="2" class="form-control">
            {% for property in form.instance.properties.all %}
              <option value="{{ property.id }}">{{ property.name }}</option>
            {% endfor %}
            </select>
            <div class="btn-group">
              <button type="button" class="btn btn-default" id="add-prop"><span class="glyphicon glyphicon-plus"></span></button>
              <button type="button" class="btn btn-default" id="remove-prop"><span class="glyphicon glyphicon-minus"></span></button>
            </div>
          </div>
        </div>
      </div>
      <div class="fixed-footer">
        {% buttons %}
        <button type="submit" class="btn btn-primary">
          Save changes
        </button>
        {% endbuttons %}
      </form>
    </div>
  </div>
</div>

{% endblock %}

{% block footer %}
<script type="text/javascript">
$(document).ready(function(){
    $(document).antioch();
    
  setupAjaxForm($('#object-form'));
  
    $('#verbs-select').dblclick(function(){
        $(document).antioch('handleMessage', {
            command: 'edit',
            details: {
                id: $('#verbs-select').val(),
                kind: 'verb'
            }
        });
    });
    
    $('#properties-select').dblclick(function(){
        $(document).antioch('handleMessage', {
            command: 'edit',
            details: {
                id: $('#properties-select').val(),
                kind: 'property'
            }
        });
    });
    
    $('#access-button').click(function(){
        $(document).antioch('handleMessage', {
            command: 'edit',
            details: {
                id: {{ form.instance.pk }},
                kind: 'access/object',
            }
        });
    });
});
</script>
{% endblock %}